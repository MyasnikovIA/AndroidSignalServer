<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html style="height: 100%;">
    <head>
      <script type="text/javascript" src="/ip_cam_dacha/ip_cam_activex.js"></script>
      <script type="text/javascript" src="/ip_cam_dacha/config_connect_ip_cam.js"></script>
      <script>
            var request = new XMLHttpRequest();
	        var moveRobot = function(cmd) {
   	            request.open('GET','/cmd:'+cmd,false);
   	            request.send();
                if (request.status == 200) {
                  return request.response;
                } else {
                  return `Ошибка ${request.status}: ${request.statusText}`;
                }
           }
           var tmp = "";
           var sendCommandListRobot = function(devName,cmd) {
   	            request.open('POST','/cmd:device:'+devName,false);
   	            request.send(cmd);
                if (request.status == 200) {
                  return request.response;
                } else {
                  return `Ошибка ${request.status}: ${request.statusText}`;
                }
           }
      </script>
     <script type="text/javascript">
        var bCrossBrow = false;
        var bnpCheck = false;
        if (navigator.userAgent.indexOf('IE') < 0) {
            var userAgent = navigator.userAgent,
                rMsie = /(msie\s|trident.*rv:)([\w.]+)/,
                rFirefox = /(firefox)\/([\w.]+)/,
                rOpera = /(opera).+version\/([\w.]+)/,
                rChrome = /(chrome)\/([\w.]+)/,
                rSafari = /version\/([\w.]+).*(safari)/;
            var browserMatch = uaMatch(userAgent.toLowerCase());
            if (browserMatch.browser != "IE") {
                bCrossBrow = true;
            }

        }

        function uaMatch(ua) {
            var match = rMsie.exec(ua);

            if (match != null) {
                return {browser: "IE", version: match[2] || "0"};
            }
            var match = rFirefox.exec(ua);
            if (match != null) {
                return {browser: match[1] || "", version: match[2] || "0"};
            }
            var match = rOpera.exec(ua);
            if (match != null) {
                return {browser: match[1] || "", version: match[2] || "0"};
            }
            var match = rChrome.exec(ua);
            if (match != null) {
                return {browser: match[1] || "", version: match[2] || "0"};
            }
            var match = rSafari.exec(ua);
            if (match != null) {
                return {browser: match[2] || "", version: match[1] || "0"};
            }
            if (match != null) {
                return {browser: "", version: "0"};
            }
        }


        var Download = function() {
            window.open("New_Active.exe");
            // window.open("http://xmsecu.com:8080/ocx/New_Active.exe");
        }
        var DetectActiveX = function() {
            try {
                var comActiveX = new ActiveXObject("WEB.WebCtrl.1");
                comActiveX = null;
            } catch (e) {
                if (bCrossBrow) {
                    return true;
                };
                return false;
            }
            return true;
        }


        // config_connect_ip_cam.js - содержить информацию для подключения к IP камере
        var ipaddress = document.location.hostname;
        var hostport = 34567;
        var serverIP = "xmeye.net";
        var serverPort = 8000;

        var runViewCam3 = function(){
             if (!DetectActiveX()) {
                return;
             }
             ocx3.SetSpecialParamEx2(2, "Russian", 0, 0);  // выбор языка
             if (0 < ocx3.SetSpecialParamEx2(1, serverIP, serverPort, "")) { }
             // var res = ocx3.Login(ipaddress, hostport, username, password);
             var res = ocx3.Login(mac3, hostport, username, password);
             if (res > 0) { ocx3.PlayAll();     }else{ alert("error: "+res); }
        }

    </script>
    </head>
    <body>

<button onclick="moveRobot('device:Gramozeka')">Connect Gramozeka</button>
<button onclick="runViewCam3();">Включить трансляцию</button>


<hr/>
   <a href="javascript:;" onmousedown="moveRobot('up');"    onmouseup="moveRobot('stop');">up</a>
   <a href="javascript:;" onmousedown="moveRobot('down');"  onmouseup="moveRobot('stop');">down</a>
   <a href="javascript:;" onmousedown="moveRobot('left');"  onmouseup="moveRobot('stop');">left</a>
   <a href="javascript:;" onmousedown="moveRobot('right');" onmouseup="moveRobot('stop');">right</a>
<hr/>

 <table style="text-align: center" border="1">
            <tr>
                <td></td>
                <td><button href="javascript:;" onclick="document.getElementById('programmText').value += '\rup';" >up</button></td>
                <td></td>

                <td><button href="javascript:;" onclick="tmp += '7';" >7</button></td>
                <td><button href="javascript:;" onclick="tmp += '8';" >8</button></td>
                <td><button href="javascript:;" onclick="tmp += '9';" >9</button></td>
            </tr>
            <tr>
                <td><button href="javascript:;" onclick="document.getElementById('programmText').value += '\rleft';" >left</button></td>
                <td><button href="javascript:;" onclick="document.getElementById('programmText').value += '\rstop';" >stop</button></td>
                <td><button href="javascript:;" onclick="document.getElementById('programmText').value += '\rright';" >right</button></td>

                <td><button href="javascript:;" onclick="tmp += '4';" >4</button></td>
                <td><button href="javascript:;" onclick="tmp += '5';" >5</button></td>
                <td><button href="javascript:;" onclick="tmp += '6';" >6</button></td>
            </tr>
            <tr>
                <td></td>
                <td><button href="javascript:;" onclick="document.getElementById('programmText').value += '\rdown';" >down</button></td>
                <td></td>

                <td><button href="javascript:;" onclick="tmp += '1';" >1</button></td>
                <td><button href="javascript:;" onclick="tmp += '2';" >2</button></td>
                <td><button href="javascript:;" onclick="tmp += '3';" >3</button></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>

                <td><button href="javascript:;" onclick="tmp += '0';" >0</button></td>
                <td><button href="javascript:;" onclick="tmp += '00';" >00</button></td>
                <td><button href="javascript:;" onclick="tmp += '000';" >000</button></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td colspan="3"><button href="javascript:;" onclick="document.getElementById('programmText').value += '\r'+tmp; tmp='';" >Enter</button></td>
            </tr>
            <tr>
                <td colspan="3">
                    <textarea id="programmText" rows="14"></textarea>
                </td>
                <td><button onclick="sendCommandListRobot('gramozeka','\nleft\n'+document.getElementById('step').value+'\nstop')"><=</button></td>
                <td><button onclick="sendCommandListRobot('Gramozeka','\nup\n'+document.getElementById('step').value+'\nstop')">up</button><br/><button onclick="sendCommandListRobot('Gramozeka','\ndown\n'+document.getElementById('step').value+'\nstop')">down</button></td>
                <td><button onclick="sendCommandListRobot('Gramozeka','\nright\n'+document.getElementById('step').value+'\nstop')">=></button></td>
            </tr>
            <tr>
                <td colspan="3">
                    <button onclick=" sendCommandListRobot('Gramozeka',document.getElementById('programmText').value+'\nstop'); ">Send device</button>
                    <button onclick="document.getElementById('programmText').value = ''; ">Clear</button>
                </td>
                <td colspan="3">
                     Step <input id="step" value="100" />
                </td>

            </tr>
        </table>

    <object id="ocx3" type="application/nptest-plugin" width="900" height="600" style="position:absolute;left:400px;top:85px"></object>

    <button onclick="ocx3.CloseSound(1);" style="color: blue;">Sound off</button>
    <button onclick="ocx3.OpenSound(-1);" style="color: blue;">Sound on</button>
    <button onclick="ocx3.StartTalk();" style="color: blue;">Mic On</button>
    <button onclick="ocx3.StopTalk();" style="color: blue;">Mic Off</button>
    <br/>
    <button onclick="ocx3.Fullscreen(true);" style="color: blue;">Fullscreen</button>
    <button onclick="ocx3.ShowDeviceConfig();" style="color: blue;">Setup IpCam</button>
    <button onclick="ocx3.ShowClientConfig();" style="color: blue;">Config IpCam</button>
    <br/>
    <button onclick="ocx3.Logout();" style="color: blue;">Logout</button>
    <br/>
    <table style="text-align: center;">
        <tr>
            <td>
                <button href="javascript:;" onmousedown="ocx3.PTZCtrlStart(-1,4,5))" onmouseup="ocx3.PTZCtrlStop(-1,4,5)" >LT </button>
            </td>
            <td>
                <button href="javascript:;" onmousedown="ocx3.PTZCtrlStart(-1,0,5)" onmouseup="ocx3.PTZCtrlStop(-1,0,5)" >T </button>
            </td>
            <td>
                <button href="javascript:;" onmousedown="ocx3.PTZCtrlStart(-1,6,5)" onmouseup="ocx3.PTZCtrlStop(-1,6,5)" >RT </button>
            </td>
        </tr>
        <tr>
            <td>
                <button href="javascript:;" onmousedown="ocx3.PTZCtrlStart(-1,2,5)" onmouseup="ocx3.PTZCtrlStop(-1,2,5)" >L </button>
            </td>
            <td>
                <button href="javascript:;" onclick="ocx3.OnBntEntermenu();" >C </button>
            </td>
            <td>
                <button href="javascript:;" onmousedown="ocx3.PTZCtrlStart(-1,3,5)" onmouseup="ocx3.PTZCtrlStop(-1,3,5)" >R </button>
            </td>
        </tr>
        <tr>
            <td>
                <button href="javascript:;" onmousedown="ocx3.PTZCtrlStart(-1,5,5)" onmouseup="ocx3.PTZCtrlStop(-1,5,5)" >LB </button>
            </td>
            <td>
                <button href="javascript:;" onmousedown="ocx3.PTZCtrlStart(-1,1,5)" onmouseup="ocx3.PTZCtrlStop(-1,1,5)" >CB </button>
            </td>
            <td>
                <button href="javascript:;" onmousedown="ocx3.PTZCtrlStart(-1,7,5)" onmouseup="ocx3.PTZCtrlStop(-1,7,5)" >RB </button>
            </td>
        </tr>
    </table>

<hr/>

    </body>
</html>
